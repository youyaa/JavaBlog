## 什么是一致性

对于一个分布式系统，不能同时满足以下三点

## CAP原则

- 一致性（Consistency）：在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）
- 可用性（Availability）：在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数据更新具备高可用性）
- 分区容错性（Partition tolerance）： 以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。

> ZK 是不是就是严格实现了 CP ，而 Eureka 则是保证了 AP。（待理解）

## 一致性模型

### 弱一致性（最终一致性）

1. DNS （Domain Name System）域名解析系统 
2. Gossip（流言）算法

### 强一致性

1. 主从同步（所有从节点返回成功后，才返回给客户端响应，可用性太低）
2. Paxos       （多数派：大部分节点都返回成功后就给客户端响应）
3. Raft
4. ZAB

## Paxos协议

Paxos用于解决分布式系统中一致性问题。分布式一致性算法（Consensus Algorithm）是一个分布式计算领域的基础性问题，其最基本的功能是为了在多个进程之间对某个（某些）值达成一致（强一致）；简单来说就是确定一个值，一旦被写入就不可改变。paxos用来实现多节点写入来完成一件事情，例如mysql主从也是一种方案，但这种方案有个致命的缺陷，如果主库挂了会直接影响业务，导致业务不可写，从而影响整个系统的高可用性。paxos协议是只是一个协议，不是具体的一套解决方案。目的是解决多节点写入问题。

> 总结：将所有节点都写入同一个值，且被写入后不再更改。这里的“值”并不是狭义上的一个数值，可以是一条命令，或者其他的。

### Basic Paxos

#### 角色

1. Client   系统外部角色，请求发起者。
2. Proposer   接受Client请求，发起Propose，并调节冲突。
3. Acceptor   提议投票和接受者。
4. Learner    提议接受者，备份，不参与投票。

#### 步骤和阶段

1. Prepare阶段

   Proposer提出一个提案，编号为N，N为大于这个Proposer之前提出的提案编号，请求Acceptor的quorum接收。

2. Promise阶段

   如果N大于此acceptor之前接收的任何提案编号则接受，否则拒绝。

3. Accept阶段

   如果达到了多数派，Proposer会发出accept请求，此请求包含提案编号N，以及内容。

4. Accepted阶段

   如果



### Multi Paxos

### Fast Paxos

